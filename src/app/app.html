<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 2C5.9 2 5 2.9 5 4V20C5 21.1 5.9 22 7 22H17C18.1 22 19 21.1 19 20V4C19 2.9 18.1 2 17 2H7ZM7 4H17V20H7V4ZM8 6V8H16V6H8ZM8 10V12H16V10H8ZM8 14V16H13V14H8Z" fill="currentColor"/>
          </svg>
        </div>
        <h1 class="app-title">Blackstone shipping pvt. ltd.</h1>
      </div>
      
      <div class="header-actions">
        <div class="user-info" *ngIf="auth.instance.getActiveAccount()">
          <span class="user-name">{{ auth.instance.getActiveAccount()?.name || 'User' }}</span>
          <div class="user-avatar">{{ (auth.instance.getActiveAccount()?.name || 'U').charAt(0).toUpperCase() }}</div>
        </div>
        
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="login()" [disabled]="interactionInProgress()" *ngIf="!auth.instance.getActiveAccount()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none">
              <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H19C20.11 23 21 22.11 21 21V9M19 9H14V4H19V9Z" fill="currentColor"/>
            </svg>
            Sign In
          </button>
          
          <button class="btn btn-secondary" (click)="logout()" *ngIf="auth.instance.getActiveAccount()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none">
              <path d="M14.08,15.59L16.67,13H7V11H16.67L14.08,8.41L15.5,7L20.5,12L15.5,17L14.08,15.59M19,3A2,2 0 0,1 21,5V9.67L19,7.67V5H5V19H19V16.33L21,14.33V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3H19Z" fill="currentColor"/>
            </svg>
            Sign Out
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Layout -->
  <div class="main-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-content">
        <div class="compose-section">
          <button class="btn btn-primary compose-btn" (click)="toggleCompose()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none">
              <path d="M3 17.25V21H6.75L17.81 9.94L14.06 6.19L3 17.25ZM20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C17.98 2.9 17.35 2.9 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04Z" fill="currentColor"/>
            </svg>
            Compose
          </button>
        </div>

        <nav class="nav-menu">
          <div class="nav-section">
            <h3 class="nav-title">Mail</h3>
            <button class="nav-item" [class.active]="view() === 'inbox'" (click)="loadInbox()" [disabled]="loading()">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4ZM20 6H4V8L12 13L20 8V6ZM4 18H20V10L12 15L4 10V18Z" fill="currentColor"/>
              </svg>
              Inbox
              <span class="badge" *ngIf="getDisplayEmails().length > 0">{{ getDisplayEmails().length }}</span>
            </button>
            
            <button class="nav-item" [class.active]="view() === 'sent'" (click)="loadSent()" [disabled]="loading()">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                <path d="M2.01 21L23 12 2.01 3 2 10L17 12 2 14 2.01 21Z" fill="currentColor"/>
              </svg>
              Sent Items
            </button>
          </div>
          
          <div class="nav-section">
            <h3 class="nav-title">Tools</h3>
            <button class="nav-item" (click)="testTokenAcquisition()" [disabled]="loading()">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" fill="currentColor"/>
              </svg>
              Test Token
            </button>
            
            <button class="nav-item" (click)="checkMailboxAccess()" [disabled]="loading()">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none">
                <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" fill="currentColor"/>
              </svg>
              Check Access
            </button>
          </div>
        </nav>

        <div class="account-info" *ngIf="auth.instance.getActiveAccount()">
          <div class="account-avatar">{{ (auth.instance.getActiveAccount()?.name || 'U').charAt(0).toUpperCase() }}</div>
          <div class="account-details">
            <div class="account-name">{{ auth.instance.getActiveAccount()?.name || 'User' }}</div>
            <div class="account-email">{{ auth.instance.getActiveAccount()?.username || 'user@example.com' }}</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Email List Column -->
    <div class="email-list-column">
      <!-- Loading State -->
      <div class="loading-overlay" *ngIf="loading()">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
      </div>

      <!-- Email List View -->
      <div class="email-section" *ngIf="!showCompose()">
        <div class="section-header">
          <h2 class="section-title">{{ view() === 'inbox' ? 'Inbox' : 'Sent Items' }}</h2>
          <div class="email-count" *ngIf="getDisplayEmails().length > 0">{{ getDisplayEmails().length }} emails</div>
        </div>
        
        <div class="email-list" *ngIf="getDisplayEmails().length > 0; else noEmails">
          <div class="email-card" 
               *ngFor="let mail of getDisplayEmails(); trackBy: trackByEmailId"
               [class.selected]="isEmailSelected(mail)"
               (click)="selectEmail(mail)">
            <div class="email-header">
              <div class="email-sender">
                <div class="sender-avatar">
                  {{ getSenderInitial(mail) }}
                </div>
                <div class="sender-info">
                  <div class="sender-name">
                    {{ view() === 'inbox' ? (mail.sender?.emailAddress?.name || mail.sender?.emailAddress?.address) : (mail.toRecipients?.[0]?.emailAddress?.name || mail.toRecipients?.[0]?.emailAddress?.address) }}
                  </div>
                  <div class="email-time">{{ mail.receivedDateTime | date:'MMM d, h:mm a' }}</div>
                </div>
              </div>
              <div class="email-actions">
                <a class="action-link" [href]="mail.webLink" target="_blank" rel="noopener">
                  <svg class="action-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" fill="currentColor"/>
                  </svg>
                </a>
              </div>
            </div>
            
            <div class="email-content">
              <h3 class="email-subject">{{ mail.subject || '(No Subject)' }}</h3>
              <p class="email-preview">{{ mail.bodyPreview || 'No preview available' }}</p>
            </div>
          </div>
        </div>
        
        <ng-template #noEmails>
          <div class="empty-state">
            <svg class="empty-icon" viewBox="0 0 24 24" fill="none">
              <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z" fill="currentColor"/>
            </svg>
            <h3>No emails found</h3>
            <p>{{ view() === 'inbox' ? 'Your inbox is empty. Sample emails are shown above.' : 'No sent emails found. Sample emails are shown above.' }}</p>
          </div>
        </ng-template>
      </div>

      <!-- Compose Email -->
      <div class="compose-section" *ngIf="showCompose()">
        <div class="section-header">
          <h2 class="section-title">Compose Email</h2>
          <button class="btn btn-secondary" (click)="toggleCompose()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" fill="currentColor"/>
            </svg>
            Cancel
          </button>
        </div>
        
        <form class="compose-form" (ngSubmit)="sendEmail()">
          <div class="form-group">
            <label class="form-label">To</label>
            <input 
              type="email" 
              class="form-input" 
              placeholder="recipient@example.com" 
              [ngModel]="to()" 
              (ngModelChange)="to.set($event)"
              required
            />
          </div>
          
          <div class="form-group">
            <label class="form-label">Subject</label>
            <input 
              type="text" 
              class="form-input" 
              placeholder="Email subject" 
              [ngModel]="subject()" 
              (ngModelChange)="subject.set($event)"
              required
            />
          </div>
          
          <div class="form-group">
            <label class="form-label">Message</label>
            <app-rich-editor 
              placeholder="Type your message here..."
              [ngModel]="body()" 
              (ngModelChange)="body.set($event)"
            ></app-rich-editor>
          </div>
          
          <div class="form-actions">
            <button 
              type="submit" 
              class="btn btn-primary" 
              [disabled]="loading() || !to() || !subject()"
            >
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none">
                <path d="M2.01 21L23 12 2.01 3 2 10L17 12 2 14 2.01 21Z" fill="currentColor"/>
              </svg>
              Send Email
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Email Detail View Column -->
    <div class="email-detail-column">
      <!-- Email Preview Pane -->
      <div class="email-preview-pane" *ngIf="selectedEmail()">
        <div class="preview-header">
          <h2 class="preview-subject">{{ selectedEmail().subject || '(No Subject)' }}</h2>
          <div class="preview-meta">
            <span class="preview-sender">
              {{ view() === 'inbox' ? (selectedEmail().sender?.emailAddress?.name || selectedEmail().sender?.emailAddress?.address) : (selectedEmail().toRecipients?.[0]?.emailAddress?.name || selectedEmail().toRecipients?.[0]?.emailAddress?.address) }}
            </span>
            <span class="preview-time">{{ selectedEmail().receivedDateTime | date:'MMM d, h:mm a' }}</span>
          </div>
        </div>
        
        <div class="preview-body">
          <div [innerHTML]="getEmailBody(selectedEmail())"></div>
        </div>
        
        <div class="preview-actions">
          <button class="btn btn-primary">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none">
              <path d="M3 17.25V21H6.75L17.81 9.94L14.06 6.19L3 17.25ZM20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C17.98 2.9 17.35 2.9 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04Z" fill="currentColor"/>
            </svg>
            Reply
          </button>
          <button class="btn btn-secondary">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none">
              <path d="M2.01 21L23 12 2.01 3 2 10L17 12 2 14 2.01 21Z" fill="currentColor"/>
            </svg>
            Forward
          </button>
        </div>
      </div>

      <!-- No Email Selected State -->
      <div class="no-email-selected" *ngIf="!selectedEmail()">
        <div class="empty-state">
          <svg class="empty-icon" viewBox="0 0 24 24" fill="none">
            <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z" fill="currentColor"/>
          </svg>
          <h3>Select an email</h3>
          <p>Choose an email from the list to view its content</p>
        </div>
      </div>
    </div>
  </div>
</div>

<router-outlet />